# utils/stock_data.py
import random
import math

# è‚¡ç¥¨å®šä¹‰ï¼ˆä¿æŒä¸å˜ï¼‰
STOCKS = {
    "FISH": {"name": "å’¸é±¼æµ·è¿", "icon": "ğŸŸ", "base_price": 50, "volatility": 0.15},
    "CATN": {"name": "çŒ«è–„è·ç”Ÿç‰©", "icon": "ğŸŒ¿", "base_price": 200, "volatility": 0.40},
    "TOY": {"name": "é€—çŒ«æ£’é‡å·¥", "icon": "ğŸ£", "base_price": 120, "volatility": 0.25},
    "BOX": {"name": "çº¸ç®±åœ°äº§", "icon": "ğŸ“¦", "base_price": 80, "volatility": 0.10},
    "DOGE": {"name": "æŸ´çŠ¬å¸", "icon": "ğŸ•", "base_price": 10, "volatility": 0.90}
}

# --- æ–°é—»ç»„åˆéƒ¨ä»¶ ---
NEWS_PARTS = {
    # [ä¸»è¯­] èº«ä»½/æœºæ„ (ä¸­æ€§)
    "subject": [
        {"text": "ä¸€ä½ä¸æ„¿é€éœ²å§“åçš„å¤ªç©ºå…¬å¸CEO", "score": 0},
        {"text": "éš”å£ç‹—é•‡çš„è´¸æ˜“ä»£è¡¨", "score": 0},
        {"text": "å–µå°”è¡—çš„ä¼ å¥‡æŠ•èµ„äººâ€œå–µè²ç‰¹â€", "score": 0},
        {"text": "ä¸€ç¾¤ç¯ä¿ä¸»ä¹‰çŒ«", "score": 0},
        {"text": "å°é•‡çš„ç½‘çº¢ä¸»æ’­", "score": 0},
        {"text": "å–µå–µè®®ä¼šçš„è®®å‘˜", "score": 0},
        {"text": "å°é•‡é“¶è¡Œçš„é¦–å¸­åˆ†æå¸ˆ", "score": 0},
        {"text": "å–µå–µå¤§å­¦çš„ç»æµå­¦æ•™æˆ", "score": 0},
        {"text": "é»‘å¸®å¤§ä½¬å–µæœ€ä¿¡ä»»çš„æ‰‹ä¸‹", "score": 0},
        {"text": "ä¸€ç¾¤åˆšç¡é†’çš„å¹¼çŒ«", "score": 0},
        {"text": "ä¸€ä¸ªç¥ç§˜çš„æ—¶é—´æ—…è¡Œè€…", "score": 0},
        {"text": "å–µå°”è¡—æ—¥æŠ¥ä¸è´Ÿè´£ä»»çš„è®°è€…", "score": 0},
        {"text": "ä¸€ä½æ™®é€šçš„é“²å±å®˜", "score": 0},
        {"text": "å°é•‡æœ€å—æ¬¢è¿çš„å…½åŒ»", "score": 0},
        {"text": "ä¸€ä¸ªè‡ªç§°æ¥è‡ªæœªæ¥çš„æœºå™¨äºº", "score": 0}
    ],
    # [åŠ¨ä½œ] è¯„ä»·/è¡Œä¸º (æœ‰åˆ©å¥½/åˆ©ç©º)
    "action": {
        "positive": [
            {"text": "å…¬å¼€èµæ‰¬äº† {name} çš„å‘å±•å‰æ™¯", "score": 1},
            {"text": "å®£å¸ƒå¤§é‡ä¹°å…¥ {name} çš„è‚¡ç¥¨", "score": 2},
            {"text": "å‘æ¨è¡¨ç¤ºâ€œæˆ‘çˆ± {name}â€", "score": 3},
            {"text": "ä¸ {name} è¾¾æˆäº†æˆ˜ç•¥åˆä½œåè®®", "score": 2},
            {"text": "é¢„æµ‹å…¶è‚¡ä»·åœ¨ä¸‹å‘¨å°†ç¿»å€", "score": 1},
            {"text": "å°†å…¶è¯„ä¸ºâ€œå¹´åº¦æœ€å€¼å¾—ä¿¡èµ–å“ç‰Œâ€", "score": 2},
            {"text": "åœ¨æ¢¦é‡Œæ¢¦åˆ°äº† {name} çš„è‚¡ç¥¨ä»£ç å¹¶å‘Šè¯‰äº†æ‰€æœ‰äºº", "score": 1},
            {"text": "è¡¨ç¤ºå…¶æŠ€æœ¯é¢†å…ˆä¸šç•Œè‡³å°‘åå¹´", "score": 2},
            {"text": "å°†å…¶äº§å“ä½œä¸ºç¤¼ç‰©é€ç»™äº†ç‹—é•‡å¤§ä½¿ï¼Œä¿ƒè¿›äº†å’Œå¹³", "score": 1},
            {"text": "åœ¨å°é•‡å¹¿åœºä¸Šä¸ºå…¶ä¸¾åŠäº†ç››å¤§çš„åº†ç¥æ´¾å¯¹", "score": 1},
            {"text": "å£°ç§°æ‰¾åˆ°äº† {name} è‚¡ä»·ä¸Šæ¶¨çš„å¿…èƒœå…¬å¼", "score": 2},
            {"text": "å°†å…¶åŠ å…¥äº†å°é•‡çš„å…»è€é‡‘æŠ•èµ„ç»„åˆ", "score": 3},
            {"text": "ä¸ºå…¶åˆ›ä½œäº†ä¸€é¦–å¹¿ä¸ºæµä¼ çš„èµç¾è¯—", "score": 1},
            {"text": "é€éœ²æ­£åœ¨ç§˜å¯†ç ”å‘ä¸ {name} ç›¸å…³çš„é¢ è¦†æ€§äº§å“", "score": 2},
            {"text": "å®£å¸ƒæœªæ¥åå¹´å°†åªä½¿ç”¨ {name} çš„äº§å“", "score": 2}
        ],
        "negative": [
            {"text": "è­¦å‘Šç§° {name} å­˜åœ¨å·¨å¤§æ³¡æ²«", "score": -2},
            {"text": "å› äº§å“è´¨é‡é—®é¢˜å…¬å¼€èµ·è¯‰äº† {name}", "score": -2},
            {"text": "å®£å¸ƒæ¸…ä»“å…¶æŒæœ‰çš„æ‰€æœ‰ {name} è‚¡ç¥¨", "score": -3},
            {"text": "å‘¼åæ‰€æœ‰å¸‚æ°‘è”åˆæŠµåˆ¶ {name} çš„äº§å“", "score": -1},
            {"text": "å‘å¸ƒäº†ä¸€ä»½é•¿è¾¾100é¡µçš„åšç©ºæŠ¥å‘Š", "score": -2},
            {"text": "ç§°å…¶CEOçš„çŒ«å¾·æœ‰äºï¼Œä¸å€¼å¾—ä¿¡ä»»", "score": -1},
            {"text": "å‘ç°å…¶è´¢åŠ¡æŠ¥è¡¨æ˜¯ç”¨çŒ«çˆªå°ç”»çš„ï¼Œæ•°æ®å­˜ç–‘", "score": -2},
            {"text": "å°†å…¶ä»â€˜å€¼å¾—ä¿¡èµ–â€™çš„ä¾›åº”å•†åå•ä¸­ç§»é™¤", "score": -1},
            {"text": "å…¬å¼€å˜²ç¬‘å…¶è¿‡æ—¶çš„å•†ä¸šæ¨¡å¼", "score": -1},
            {"text": "çˆ†æ–™å…¶å†…éƒ¨ç®¡ç†æ··ä¹±ï¼Œå‘˜å·¥éƒ½åœ¨ä¸Šç­æ—¶é—´ç¡è§‰", "score": -2},
            {"text": "è®¤ä¸ºå…¶æŠ€æœ¯æ¯«æ— åˆ›æ–°ï¼Œæ˜¯åœ¨â€œå•ƒè€æœ¬â€", "score": -1},
            {"text": "å‘èµ·äº†ä¸€é¡¹â€œ30å¤©ä¸ä½¿ç”¨{name}â€çš„ç½‘ç»œæŒ‘æˆ˜", "score": -1},
            {"text": "åœ¨å°é•‡æ—¥æŠ¥ä¸ŠåˆŠç™»äº†æ•´ç‰ˆçš„æ‰¹è¯„å¹¿å‘Š", "score": -2},
            {"text": "é¢„æµ‹å…¶å°†åœ¨ä¸‹ä¸ªæœˆç”³è¯·ç ´äº§ä¿æŠ¤", "score": -3},
            {"text": "å£°ç§°å…¶äº§å“ä¼šå¸¦æ¥éš¾ä»¥é¢„æ–™çš„å„è¿", "score": -1}
        ]
    },
    # [äº‹ä»¶] ç‰¹å®šäºæŸæ”¯è‚¡ç¥¨çš„ç‹¬ç«‹äº‹ä»¶
    "event": {
        "FISH": [
            {"text": "æ•è·äº†ä¸€æ‰¹æå…¶ç½•è§çš„æ·±æµ·é‡‘æªé±¼", "score": 2},
            {"text": "çš„ä¸»åŠ›è´§èˆ¹é­é‡äº†æµ·ç›—çŒ«çš„çªç„¶è¢­å‡»", "score": -3},
            {"text": "å¼€è¾Ÿäº†ä¸€æ¡é€šå¾€æ–°æ¸”åœºçš„é»„é‡‘èˆªçº¿ï¼Œæ¸”è·é‡å¤§å¢", "score": 3},
            {"text": "å› è¿‡åº¦æ•æè¢«æµ·æ´‹ä¿æŠ¤åä¼šå¤„ä»¥å·¨é¢ç½šæ¬¾", "score": -2},
            {"text": "å‘æ˜äº†æ°¸ä¸è…åçš„å’¸é±¼å¹²ä¿é²œæŠ€æœ¯", "score": 2},
            {"text": "çš„èˆ¹é˜Ÿåœ¨ç™¾æ…•å¤§ä¸‰è§’ç¥ç§˜å¤±è”äº†ä¸€æ•´å¤©", "score": -2},
            {"text": "ä¸æµ·é¸¥ä»¬è¾¾æˆäº†å¯¼èˆªä¸åæµ·ç›—æˆ˜ç•¥åˆä½œ", "score": 1},
            {"text": "çš„å†·åº“ç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œä¸€åŠçš„é±¼éƒ½å˜è´¨äº†", "score": -3},
            {"text": "åœ¨ä¸€æ¬¡æ·±æµ·æ¢ç´¢ä¸­æ‰“æåˆ°äº†å¤ä»£æ²‰èˆ¹çš„å®è—", "score": 3},
            {"text": "çš„å¯¼èˆªç³»ç»Ÿå¤±çµï¼ŒæŠŠä¸€èˆ¹é±¼é€åˆ°äº†å¤§æ²™æ¼ ", "score": -1},
            {"text": "çš„èˆ¹å‘˜å› ä¼™é£Ÿå¤ªå·®å®£å¸ƒé›†ä½“ç½¢å·¥", "score": -2},
            {"text": "æ–°å»ºé€ çš„æ——èˆ°â€œå–µå¯æ³¢ç½—å·â€æ­£å¼ä¸‹æ°´", "score": 2},
            {"text": "è¢«ä¸€ç¾¤è™é²¸ç¾¤ç›¯ä¸Šï¼Œè¢«è¿«ç»•é“è¡Œé©¶ï¼Œæˆæœ¬å¤§å¢", "score": -1},
            {"text": "çš„æ¸”ç½‘è¢«è¯„ä¸ºâ€œå¹´åº¦æœ€åšå›ºå‘æ˜â€", "score": 1},
            {"text": "æ„å¤–å‘ç°ä¸€ç‰‡å¯Œå«çç çš„ç‰¡è›å…»æ®–åœº", "score": 2}
        ],
        "CATN": [
            {"text": "çš„æœ€æ–°ç ”ç©¶å‘ç°çŒ«è–„è·èƒ½æ˜¾è‘—æå‡çŒ«å’ªçš„æ•°å­¦èƒ½åŠ›", "score": 3},
            {"text": "çš„ä»“åº“å‘ç”Ÿç¥ç§˜ç«ç¾ï¼Œä¸€åŠçš„åº“å­˜åŒ–ä¸ºç°çƒ¬", "score": -3},
            {"text": "æˆåŠŸåˆæˆäº†æ–°å“ç§â€œå½©è™¹çŒ«è–„è·â€ï¼Œå¸å®Œèƒ½çœ‹è§å½©è™¹", "score": 2},
            {"text": "è¢«æ›å‡ºåœ¨äº§å“ä¸­æºæ‚æ™®é€šè–„è·å¶ä»¥æ¬¡å……å¥½", "score": -2},
            {"text": "åœ¨æœˆçƒä¸Šå»ºç«‹äº†é¦–ä¸ªå¤ªç©ºçŒ«è–„è·ç§æ¤åŸºåœ°", "score": 3},
            {"text": "çš„æ ¸å¿ƒç§‘å­¦å®¶å¸¦ç€æœºå¯†é…æ–¹è·³æ§½å»äº†éš”å£ç‹—é•‡", "score": -3},
            {"text": "æå–å‡ºèƒ½äº§ç”Ÿç»å¯¹å¹¸ç¦æ„Ÿçš„â€œå¿«ä¹ç´ â€ï¼Œå·²ç”³è¯·ä¸“åˆ©", "score": 2},
            {"text": "çš„ç§æ¤å›­è¢«ä¸€ç¾¤çˆ±åƒç´ çš„ç¾Šé©¼å•ƒå¾—ä¸€å¹²äºŒå‡€", "score": -2},
            {"text": "æˆä¸ºäº†å°é•‡å®˜æ–¹æŒ‡å®šçš„â€œæƒ…ç»ªç¨³å®šä¾›åº”å•†â€", "score": 2},
            {"text": "çš„äº§å“è¢«æŒ‡æ§ä¼šå¯¼è‡´çŒ«å’ªæ²‰è¿·ç¡è§‰ï¼Œæ— å¿ƒå·¥ä½œ", "score": -1},
            {"text": "çš„è¿è¾“è½¦é˜Ÿåœ¨è·¯ä¸Šå‘ç”Ÿæ³„æ¼ï¼Œå¯¼è‡´æ•´æ¡è¡—çš„çŒ«éƒ½å—¨äº†", "score": 1},
            {"text": "å› å¹²æ—±å¤©æ°”å¯¼è‡´ä»Šå¹´çš„çŒ«è–„è·ä¸¥é‡å‡äº§", "score": -2},
            {"text": "çš„çŒ«è–„è·å‘³ç©ºæ°”æ¸…æ–°å‰‚æ„å¤–è·å¾—äº†ç‹—ç¾¤çš„å–œçˆ±ï¼Œå¸‚åœºæ‰©å¤§", "score": 2},
            {"text": "è¢«æŒ‡æ§å…¶ç§æ¤å›­ç ´åäº†å½“åœ°çš„ç”Ÿæ€ç¯å¢ƒ", "score": -1},
            {"text": "å®£å¸ƒå°†ä¸å’¸é±¼æµ·è¿åˆä½œï¼Œå¼€æ‹“æµ·å¤–å¸‚åœº", "score": 1}
        ],
        "TOY": [
            {"text": "æ¨å‡ºäº†ä¸€æ¬¾èƒ½å’ŒçŒ«å’ªè¿›è¡Œå“²å­¦è¾©è®ºçš„æ™ºèƒ½é€—çŒ«æ£’", "score": 3},
            {"text": "çš„æ¿€å…‰ç¬”äº§å“å› å®‰å…¨éšæ‚£è¢«å‹’ä»¤å…¨çƒå¬å›", "score": -2},
            {"text": "æˆä¸ºäº†å¹´åº¦â€œå¸çŒ«èŠ‚â€çš„ç‹¬å®¶ç©å…·èµåŠ©å•†ï¼Œå“ç‰Œæ›å…‰åº¦å¤§å¢", "score": 2},
            {"text": "çš„æ ¸å¿ƒè®¾è®¡ä¸“åˆ©è¢«ç«äº‰å¯¹æ‰‹â€œé€—ç‹—æ£’å…¬å¸â€æŠ„è¢­", "score": -1},
            {"text": "åœ¨VRé€—çŒ«æŠ€æœ¯ä¸Šå–å¾—é©å‘½æ€§çªç ´", "score": 2},
            {"text": "çš„ç”Ÿäº§çº¿è¢«ä¸€ç¾¤è°ƒçš®çš„çŒ«å’ªå é¢†ï¼Œæ— æ³•æ­£å¸¸å¼€å·¥", "score": -2},
            {"text": "ä¸çŸ¥ååŠ¨æ¼«ã€Šè¿›å‡»çš„çŒ«å’ªã€‹è¾¾æˆIPè”åŠ¨", "score": 2},
            {"text": "å› åŸææ–™ç¾½æ¯›ä»·æ ¼ä¸Šæ¶¨ï¼Œç”Ÿäº§æˆæœ¬æ€¥å‰§å¢åŠ ", "score": -1},
            {"text": "å‘æ˜äº†æ°¸ä¸æ–­ç”µçš„æ¿€å…‰ç¬”ï¼Œå¤‡å—å¥½è¯„", "score": 3},
            {"text": "CEOåœ¨äº§å“å‘å¸ƒä¼šä¸Šæ¼”ç¤ºäº§å“æ—¶ç¡ç€äº†ï¼Œå¼•å‘å¸‚åœºæ‹…å¿§", "score": -2},
            {"text": "å¼€å‘å‡ºèƒ½è‡ªåŠ¨æ‰“æ‰«çŒ«æ¯›çš„ç©å…·è€é¼ ï¼Œå¹¿å—é“²å±å®˜æ¬¢è¿", "score": 2},
            {"text": "çš„ä»“åº“è¢«ä¸€ç¾¤è€é¼ å½“æˆäº†æ¸¸ä¹åœºï¼Œäº§å“æŸåä¸¥é‡", "score": -1},
            {"text": "çš„äº§å“åœ¨æµ·å¤–å¸‚åœºæ„å¤–å¤§å—æ¬¢è¿", "score": 2},
            {"text": "è¢«æŒ‡æ§å…¶ç©å…·ä¼šè®©çŒ«å’ªå˜å¾—è¿‡åº¦å…´å¥‹ï¼Œå½±å“é‚»é‡Œå…³ç³»", "score": -1},
            {"text": "è·å¾—äº†â€œå°é•‡æœ€ä½³é›‡ä¸»â€ç§°å·ï¼Œå‘˜å·¥å£«æ°”é«˜æ¶¨", "score": 1}
        ],
        "BOX": [
            {"text": "å‘æ˜äº†å†¬æš–å¤å‡‰è¿˜èƒ½è‡ªæ¸…æ´çš„æ’æ¸©çº¸ç®±ï¼Œè®¢å•æ¿€å¢", "score": 3},
            {"text": "çš„çº¸ç®±è¢«å‘ç°æ˜¯â€œè±†è…æ¸£å·¥ç¨‹â€ï¼Œä¸€ç¢°å°±ç¢ï¼Œä¿¡èª‰æ‰«åœ°", "score": -3},
            {"text": "æ”¶è´­äº†å°é•‡æ‰€æœ‰çš„åºŸå“å›æ”¶ç«™ï¼Œå½¢æˆè¡Œä¸šå„æ–­", "score": 2},
            {"text": "çš„ä¸»è¦ä»“åº“é­é‡äº†ç™½èšä¾µè¢­ï¼ŒæŸå¤±æƒ¨é‡", "score": -2},
            {"text": "å°é•‡é€šè¿‡äº†â€œä¸€çŒ«ä¸€ç®±â€çš„ä½æˆ¿ä¿éšœæ³•æ¡ˆ", "score": 3},
            {"text": "ä¸€åœºçªå¦‚å…¶æ¥çš„å¤§é›¨æ·‹æ¹¿äº†æ‰€æœ‰éœ²å¤©å­˜æ”¾çš„çº¸ç®±", "score": -2},
            {"text": "å‘ç°äº†å·¨å¤§çš„å¤ä»£çº¸ç®±æ–‡æ˜é—è¿¹ï¼Œå¼•å‘è€ƒå¤çƒ­æ½®", "score": 1},
            {"text": "å› èƒ¶å¸¦ä¾›åº”å•†çªç„¶å€’é—­ï¼Œæ‰€æœ‰äº§å“æ— æ³•å°ç®±å‘è´§", "score": -1},
            {"text": "å…¶è®¾è®¡çš„â€œè¿·å®«çº¸ç®±â€è·å¾—äº†å¹´åº¦æœ€ä½³è®¾è®¡å¥–", "score": 2},
            {"text": "è¢«ä¸€ç¾¤æµæµªç‹—å½“æˆäº†ç£¨ç‰™æ£’ï¼Œå®¢æˆ·æŠ•è¯‰ä¸æ–­", "score": -1},
            {"text": "ä¸é€—çŒ«æ£’é‡å·¥åˆä½œï¼Œæ¨å‡ºå†…ç½®ç©å…·çš„å¨±ä¹çº¸ç®±", "score": 1},
            {"text": "è¢«ç¯ä¿ç»„ç»‡æŠ—è®®ï¼ŒæŒ‡å…¶æµªè´¹äº†è¿‡å¤šçš„æ£®æ—èµ„æº", "score": -1},
            {"text": "å‘æ˜äº†å¯ä»¥æŠ˜å æˆä»»æ„å½¢çŠ¶çš„â€œå˜å½¢çº¸ç®±â€", "score": 2},
            {"text": "å°é•‡å¼€å§‹æµè¡Œç¡å¡‘æ–™ç›†ï¼Œçº¸ç®±çš„éœ€æ±‚é‡æœ‰æ‰€ä¸‹é™", "score": -1},
            {"text": "è·å¾—äº†å†›æ–¹çš„å¤§é¢è®¢å•ï¼Œç”¨äºå»ºé€ ä¸´æ—¶çŒ«å’ªå…µè¥", "score": 2}
        ],
        "DOGE": [
            {"text": "çš„å›¾æ ‡è¢«ç”»åœ¨äº†ä¸€æšå³å°†å‘å°„çš„ç«ç®­ä¸Šï¼Œå°†ç™»é™†æœˆçƒ", "score": 4},
            {"text": "çš„åˆ›å§‹äººçªç„¶å®£å¸ƒåˆ åº“è·‘è·¯ï¼Œç•™ä¸‹ä¸€å¥â€œå†è§ï¼Œå‚»ç“œä»¬â€", "score": -5},
            {"text": "è¢«å°é•‡æœ€ç«çš„å’–å•¡åº—å®£å¸ƒæ¥å—ä¸ºæ”¯ä»˜æ–¹å¼", "score": 3},
            {"text": "è¢«å‘ç°å…¶æ‰€è°“çš„â€œåŒºå—é“¾â€ç½‘ç»œå…¶å®ç”±ä¸‰åªä»“é¼ åœ¨è·‘è½®é©±åŠ¨", "score": -4},
            {"text": "ä¸€å¼ æå…¶å¯çˆ±çš„æŸ´çŠ¬æ–°è¡¨æƒ…åŒ…åœ¨ç½‘ç»œä¸Šç—…æ¯’å¼ä¼ æ’­", "score": 2},
            {"text": "è¢«å°é•‡é“¶è¡Œè¡Œé•¿å…¬å¼€æ–¥è´£ä¸ºâ€œæ¯«æ— ä»·å€¼çš„éª—å±€â€", "score": -3},
            {"text": "å¼€å‘è€…å®£å¸ƒå°†é”€æ¯99%çš„ä¾›åº”é‡ï¼Œé€ æˆé€šç¼©é¢„æœŸ", "score": 4},
            {"text": "ä¸»è¦äº¤æ˜“æœåŠ¡å™¨çš„ç”µçº¿è¢«ä¸€åªè·¯è¿‡çš„æ¾é¼ å’¬æ–­äº†", "score": -2},
            {"text": "åœ¨ä¸€éƒ¨çƒ­æ’­ç§‘å¹»å‰§ä¸­è¢«æç»˜æˆæœªæ¥çš„å®‡å®™é€šç”¨è´§å¸", "score": 3},
            {"text": "è¢«å¦ä¸€ç§åŠ¨ç‰©å¸â€œå“ˆå£«å¥‡å¸â€æŠ¢èµ°äº†æ‰€æœ‰å¸‚åœºçƒ­åº¦", "score": -3},
            {"text": "ä¸€ä½å°‘å¹´é»‘å®¢å£°ç§°æ‰¾åˆ°äº†æ— é™å¢å‘è¯¥å¸çš„æ¼æ´", "score": -4},
            {"text": "ç¤¾åŒºå‘èµ·æŠ•ç¥¨ï¼Œå†³å®šå°†å›¾æ ‡æ¢æˆä¸€åªçŒ«ï¼Œå¼•å‘èº«ä»½è®¤åŒå±æœº", "score": -1},
            {"text": "ç¥ç§˜ä»£ç æ˜¾ç¤ºå…¶æœ€ç»ˆç›®æ ‡æ˜¯è§£å¼€å®‡å®™çš„ç»ˆæçœŸç†", "score": 2},
            {"text": "è¢«å‘ç°å…¶å…¨éƒ¨ä»£ç åŠ èµ·æ¥åªæœ‰ä¸€è¡Œæ³¨é‡Šï¼šâ€œæ±ªæ±ªæ±ªï¼â€", "score": -2},
            {"text": "æ²¡æœ‰ä»»ä½•ç†ç”±ï¼Œå®ƒå°±æ˜¯çªç„¶æ¶¨äº†/è·Œäº†ï¼Œå› ä¸ºå®ƒæ˜¯æŸ´çŠ¬å¸", "score": random.choice([-5, 5])}
        ]
    }
}

def calculate_next_price(stock_id, current_price, news_score):
    """
    æ ¹æ®å½“å‰ä»·æ ¼ã€åŸºç¡€ä»·æ ¼å’Œæ–°é—»åˆ†æ•°ï¼Œè®¡ç®—ä¸‹ä¸€ä¸ªä»·æ ¼ã€‚
    åŒ…å«ã€å‡å€¼å›å½’ã€‘å’Œã€é˜»å°¼æœºåˆ¶ã€‘é˜²æ­¢æ•°æ®çˆ†ç‚¸ã€‚
    """
    stock_info = STOCKS[stock_id]
    base_price = stock_info["base_price"]
    volatility = stock_info["volatility"]
    
    # --- æœºåˆ¶A: åŸºç¡€æ¶¨è·Œå¹… ---
    # åˆ†æ•°æ¯å¢åŠ 1åˆ†ï¼Œç†è®ºæ³¢åŠ¨ x%
    # æ¯”å¦‚ BOX volatility=0.1, score=3 -> ç†è®ºæ¶¨ 30%
    raw_change_pct = volatility * news_score * 0.1 

    # --- æœºåˆ¶B: å‡å€¼å›å½’ (æ©¡çš®ç­‹æ•ˆåº”) ---
    # è®¡ç®—åç¦»åº¦: ratio = å½“å‰ä»· / åŸºç¡€ä»·
    # å¦‚æœ ratio=10 (æ¶¨äº†10å€)ï¼Œå®ƒåº”è¯¥å¾ˆéš¾å†æ¶¨ï¼Œä½†å¾ˆå®¹æ˜“è·Œ
    ratio = current_price / base_price
    
    final_change_pct = raw_change_pct

    # 1. æŠ‘åˆ¶æš´æ¶¨ (å½“ä»·æ ¼é«˜äºåŸºå‡†ä¸”åˆ©å¥½æ—¶)
    if ratio > 1.2 and raw_change_pct > 0:
        # ä½¿ç”¨å¯¹æ•°å‡½æ•°è¿›è¡Œå‹ç¼©ï¼šä»·æ ¼è¶Šé«˜ï¼Œåˆ†æ¯è¶Šå¤§ï¼Œæ¶¨å¹…è¶Šå°
        # ä¾‹å¦‚ 10å€ä»·æ ¼æ—¶ï¼Œæ¶¨å¹…ä¼šè¢«é™¤ä»¥ ~3.3
        damping = math.log(ratio) + 1
        final_change_pct = raw_change_pct / damping
        
    # 2. æŠ‘åˆ¶å½’é›¶ (å½“ä»·æ ¼ä½äºåŸºå‡†ä¸”åˆ©ç©ºæ—¶)
    elif ratio < 0.8 and raw_change_pct < 0:
        # ä»·æ ¼è¶Šä½ï¼Œè·Œå¹…æ‰“æŠ˜ã€‚å¦‚æœå‰© 10%ï¼Œè·Œå¹…ä¹˜ä»¥ 0.1ï¼Œè·Œå¾—ææ…¢
        final_change_pct = raw_change_pct * ratio

    # --- æœºåˆ¶C: ç†”æ–­é™åˆ¶ (ç¡¬é¡¶/ç¡¬åº•) ---
    # å•æ¬¡æ¶¨è·Œå¹…é™åˆ¶åœ¨ Â±35% ä»¥å†… (DOGEé™¤å¤–)
    limit = 0.80 if stock_id == "DOGE" else 0.35
    if final_change_pct > limit: final_change_pct = limit
    if final_change_pct < -limit: final_change_pct = -limit

    # --- è®¡ç®—æ–°ä»·æ ¼ ---
    next_price = current_price * (1 + final_change_pct)
    
    # ä¿åº•ä»·æ ¼ (é˜²æ­¢å˜æˆè´Ÿæ•°æˆ–0)
    if next_price < 0.5: 
        next_price = 0.5
        
    return round(next_price, 2), round(final_change_pct * 100, 2)


def generate_dynamic_news(stock_id, current_price=None):
    """
    åŠ¨æ€ç”Ÿæˆæ–°é—»ã€‚
    å‚æ•° current_price (å¯é€‰): å¦‚æœä¼ å…¥å½“å‰ä»·æ ¼ï¼Œç³»ç»Ÿä¼šæ ¹æ®ä»·æ ¼é«˜ä½
    æ™ºèƒ½è°ƒæ•´ç”Ÿæˆåˆ©å¥½è¿˜æ˜¯åˆ©ç©ºçš„æ¦‚ç‡ï¼ˆé«˜ä½è‡ªåŠ¨å”±ç©ºï¼Œä½ä½è‡ªåŠ¨å”±å¤šï¼‰ã€‚
    """
    stock_name = STOCKS[stock_id]["name"]
    stock_base = STOCKS[stock_id]["base_price"]
    
    # --- æ™ºèƒ½æ¦‚ç‡è°ƒæ•´ ---
    # é»˜è®¤ 50% æ¦‚ç‡æ˜¯æ­£é¢äº‹ä»¶
    positive_prob = 0.5
    
    if current_price:
        ratio = current_price / stock_base
        if ratio > 5.0:   # æ¶¨äº†5å€ä»¥ä¸Š
            positive_prob = 0.2  # åªæœ‰20%æ¦‚ç‡å‡ºå¥½æ¶ˆæ¯ (æ€ä¼°å€¼)
        elif ratio < 0.3: # è·Œå‰©30%
            positive_prob = 0.8  # 80%æ¦‚ç‡å‡ºå¥½æ¶ˆæ¯ (æŠ„åº•)

    # å†³å®šæ–°é—»ç±»å‹ï¼š60%æ¦‚ç‡ç‰¹å®šäº‹ä»¶ï¼Œ40%é€šç”¨æ‹¼æ¥
    if random.random() < 0.6:
        # ç‰¹å®šäº‹ä»¶
        # ç®€å•å¤„ç†ï¼šå¦‚æœéšæœºæ•° < positive_probï¼Œå°è¯•æ‰¾åˆ†æ•°ä¸ºæ­£çš„äº‹ä»¶ï¼Œå¦åˆ™æ‰¾è´Ÿçš„
        # ä¸ºäº†ä»£ç ç®€å•ï¼Œè¿™é‡Œå…ˆéšæœºå–ï¼Œå¦‚æœä¸ç¬¦åˆå€¾å‘å†é‡è¯•ä¸€æ¬¡
        candidates = NEWS_PARTS["event"][stock_id]
        chosen_event = random.choice(candidates)
        
        # ç®€å•çš„é‡è¯•æœºåˆ¶ä»¥ç¬¦åˆæ¦‚ç‡å€¾å‘
        is_positive_event = chosen_event["score"] > 0
        if (positive_prob > 0.6 and not is_positive_event) or \
           (positive_prob < 0.4 and is_positive_event):
            # å€¾å‘ä¸ç¬¦ï¼Œé‡æŠ½ä¸€æ¬¡
            chosen_event = random.choice(candidates)

        news_text = f"æ®å–µå°”è¡—æ—¥æŠ¥æŠ¥é“ï¼Œ{stock_name} {chosen_event['text']}ã€‚"
        total_score = chosen_event["score"]
    else:
        # é€šç”¨æ‹¼æ¥
        subject_part = random.choice(NEWS_PARTS["subject"])
        
        # æ ¹æ®æ¦‚ç‡å†³å®šåŠ¨ä½œæ˜¯å¥½æ˜¯å
        trend_key = "positive" if random.random() < positive_prob else "negative"
        action_part = random.choice(NEWS_PARTS["action"][trend_key])
        
        news_text = subject_part["text"] + " " + action_part["text"].format(name=stock_name)
        total_score = subject_part["score"] + action_part["score"]
        
    return news_text, total_score
